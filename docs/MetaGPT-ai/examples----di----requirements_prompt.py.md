
# `.\MetaGPT\examples\di\requirements_prompt.py` 详细设计文档

该代码文件定义了一个任务需求配置库，主要用于存储和分类多个AI代理任务（如数据分析、OCR、网页爬虫、图像处理、游戏开发等）的详细指令模板。它通过两个主要的字典（ML_BENCHMARK_REQUIREMENTS 和 OPEN_ENDED_TASKS_REQUIREMENTS）来组织任务，每个任务对应一个包含具体步骤、约束条件和输出格式的字符串模板。这些模板旨在为自动化AI代理提供清晰、结构化的执行指南。

## 整体流程

```mermaid
graph TD
    A[开始] --> B{任务类型?}
    B -- 机器学习基准测试 --> C[从 ML_BENCHMARK_REQUIREMENTS 获取任务指令]
    B -- 开放式任务 --> D[从 OPEN_ENDED_TASKS_REQUIREMENTS 获取任务指令]
    C --> E[解析指令中的占位符，如 {data_dir}]
    D --> E
    E --> F[将格式化后的指令传递给AI代理执行]
    F --> G[AI代理执行具体任务，如数据分析、OCR、爬虫等]
    G --> H[任务完成]
```

## 类结构

```
任务需求配置库
├── 机器学习基准测试任务 (ML_BENCHMARK_REQUIREMENTS)
│   ├── 01_iris
│   ├── 02_wines_recognition
│   ├── 03_breast_cancer
│   ├── 04_titanic
│   ├── 05_house_prices
│   ├── 06_santander_customer
│   ├── 07_icr_identify
│   └── 08_santander_value
└── 开放式任务 (OPEN_ENDED_TASKS_REQUIREMENTS)
    ├── OCR任务 (01_ocr, 02_ocr, 03_ocr)
    ├── 网页搜索与爬虫任务 (04-07)
    ├── 邮件回复任务 (08_email_reply)
    ├── 网页模仿任务 (09-13)
    ├── 图像处理任务 (14_image_background_removal)
    ├── 文本生成图像任务 (15_text2img)
    ├── 图像生成代码任务 (16-17)
    └── 游戏生成任务 (18-20)
```

## 全局变量及字段


### `DABENCH`
    
一个用于生成DABench任务要求的格式化字符串模板，包含占位符如{question}、{file_name}等。

类型：`str`
    


### `IRIS_REQ`
    
针对sklearn Iris数据集的数据分析任务要求，包括生成图表。

类型：`str`
    


### `WINES_RECOGNITION_REQ`
    
针对sklearn Wine recognition数据集的数据分析任务要求，包括生成图表、训练预测模型并报告准确率。

类型：`str`
    


### `BREAST_CANCER_WISCONSIN_REQ`
    
针对sklearn Wisconsin Breast Cancer数据集的数据分析任务要求，包括生成图表、训练预测模型并报告验证准确率。

类型：`str`
    


### `TITANIC_REQ`
    
针对泰坦尼克号乘客生存预测数据集的任务要求，包括数据分析、预处理、特征工程、建模，并报告评估集准确率。

类型：`str`
    


### `HOUSE_PRICES_ADVANCED_REGRESSION_TECHNIQUES_REQ`
    
针对房价预测数据集的任务要求，包括数据分析、预处理、特征工程、建模，并报告评估集的对数RMSE。

类型：`str`
    


### `SANTANDER_CUSTOMER_TRANSACTION_PREDICTION_REQ`
    
针对Santander客户交易预测数据集的任务要求，包括数据分析、预处理、特征工程、建模，并报告评估集的AUC。

类型：`str`
    


### `ICR_IDENTITY_AGE_RELATED_CONDITIONS_REQ`
    
针对ICR年龄相关疾病识别数据集的任务要求，包括数据分析、预处理、特征工程、建模，并报告评估集的F1分数。

类型：`str`
    


### `SANTANDER_VALUE_PREDICTION_CHALLENGE_REQ`
    
针对Santander价值预测挑战数据集的任务要求，包括数据分析、预处理、特征工程、建模，并报告评估集的RMSLE。

类型：`str`
    


### `OCR_REQ_01`
    
针对英文发票图像的OCR任务要求，使用PaddleOCR提取总金额并保存为表格。

类型：`str`
    


### `OCR_REQ_02`
    
针对中文发票图像的OCR任务要求，使用PaddleOCR提取总金额和以'No'开头的收据ID并保存为表格。

类型：`str`
    


### `OCR_REQ_03`
    
针对发票图像的OCR任务要求，使用PaddleOCR提取总金额并保存为Excel表格。

类型：`str`
    


### `WEB_SEARCH_AND_CRAWLING_REQ_04`
    
针对ICLR 2024统计网页的爬虫任务要求，提取包含特定关键词的论文列表并保存为CSV文件。

类型：`str`
    


### `WEB_SEARCH_AND_CRAWLING_REQ_05`
    
针对中国国家统计局CPI数据网页的爬虫任务要求，包括编码检测、内容提取、正则匹配和中文摘要。

类型：`str`
    


### `WEB_SEARCH_AND_CRAWLING_REQ_06`
    
针对Scrapeme.live电商网站的爬虫任务要求，提取第一页产品信息并保存为CSV文件。

类型：`str`
    


### `WEB_SEARCH_AND_CRAWLING_REQ_07`
    
针对36kr创投平台融资快讯的爬虫任务要求，提取最近3天的快讯信息并保存为CSV文件。

类型：`str`
    


### `EMAIL_REPLY_REQ_08`
    
针对Outlook邮箱的自动邮件回复任务要求，检查最新邮件并自动回复特定后缀的邮件。

类型：`str`
    


### `WEB_PAGE_IMITATION_REQ_09`
    
针对Medium网页的模仿任务要求，使用Selenium渲染并生成包含HTML、CSS和JS的网页文件。

类型：`str`
    


### `WEB_PAGE_IMITATION_REQ_10`
    
针对PyTorch官网的模仿任务要求，使用Selenium渲染并生成包含HTML、CSS和JS的网页文件。

类型：`str`
    


### `WEB_PAGE_IMITATION_REQ_11`
    
针对Kaggle网站的模仿任务要求，使用Selenium最大化窗口渲染并生成包含HTML、CSS和JS的网页文件。

类型：`str`
    


### `WEB_PAGE_IMITATION_REQ_12`
    
针对ChatGPT登录页面的模仿任务要求，使用Selenium最大化窗口渲染并生成包含HTML、CSS和JS的网页文件。

类型：`str`
    


### `WEB_PAGE_IMITATION_REQ_13`
    
针对DeepMind Gemini技术介绍页面的模仿任务要求，使用Selenium最大化窗口渲染并生成包含HTML、CSS和JS的网页文件。

类型：`str`
    


### `IMAGE_BACKGROUND_REMOVAL_REQ_14`
    
针对图像背景移除的任务要求，使用rembg工具移除指定图像的背景并保存结果。

类型：`str`
    


### `TEXT2IMG_REQ_15`
    
针对文本生成图像的任务要求，使用Stable Diffusion服务生成一张美丽女孩的图像。

类型：`str`
    


### `IMAGE2CODE_GENERATION_REQ_16`
    
针对图像转网页代码的任务要求，将指定图像转换为包含HTML、CSS和JS的网页代码并保存。

类型：`str`
    


### `IMAGE2CODE_GENERATION_REQ_17`
    
针对图像转网页代码的任务要求，将指定图像转换为包含HTML、CSS和JS的网页代码并保存。

类型：`str`
    


### `GENERATE_GAMES_REQ_18`
    
针对生成贪吃蛇游戏的任务要求，使用pyxel环境创建具有基本逻辑和用户界面的游戏。

类型：`str`
    


### `GENERATE_GAMES_REQ_19`
    
针对生成跳跃游戏的任务要求，使用pyxel环境创建包含左右移动和跳跃功能的简单游戏。

类型：`str`
    


### `GENERATE_GAMES_REQ_20`
    
针对生成贪吃蛇游戏的任务要求，使用pyxel环境创建具有基本逻辑和用户界面的游戏。

类型：`str`
    


### `ML_BENCHMARK_REQUIREMENTS`
    
一个字典，将机器学习基准测试任务的标识符映射到其对应的任务要求字符串。

类型：`dict[str, str]`
    


### `OPEN_ENDED_TASKS_REQUIREMENTS`
    
一个字典，将开放式任务的标识符映射到其对应的任务要求字符串。

类型：`dict[str, str]`
    


    

## 全局函数及方法



## 关键组件


### 任务需求字符串常量

定义了多个任务的具体需求描述字符串，涵盖了数据分析和机器学习基准测试、开放式任务（如OCR、网页爬虫、邮件回复、网页模仿、图像处理、代码生成、游戏开发）等多个领域。

### 机器学习基准测试需求字典 (`ML_BENCHMARK_REQUIREMENTS`)

一个将任务标识符（如"01_iris"）映射到对应任务需求字符串的字典，用于组织和管理机器学习基准测试任务。

### 开放式任务需求字典 (`OPEN_ENDED_TASKS_REQUIREMENTS`)

一个将任务标识符（如"01_ocr"）映射到对应任务需求字符串的字典，用于组织和管理各种开放式、非结构化的任务。


## 问题及建议


### 已知问题

-   **硬编码与配置管理缺失**：所有任务需求字符串均以硬编码形式直接写在代码中，导致配置变更（如数据路径、API地址、评估指标）时必须修改源代码，降低了代码的可维护性和灵活性。
-   **重复代码与不一致性**：存在大量重复的任务描述，例如 `GENERATE_GAMES_REQ_18` 和 `GENERATE_GAMES_REQ_20` 的内容几乎完全相同，这增加了维护成本，并可能导致未来更新时出现遗漏或错误。
-   **安全风险**：`EMAIL_REPLY_REQ_08` 任务描述中明文包含了邮箱账户和密码，这是严重的安全漏洞，可能导致敏感信息泄露。
-   **结构松散，缺乏抽象**：代码仅定义了常量字符串和两个字典，没有封装成任何类或模块。这种扁平化的结构在面对大量、多样化的任务时，难以进行有效的组织、扩展和复用。
-   **外部依赖路径硬编码**：多个任务描述（如Titanic、OCR等）中硬编码了 `{data_dir}` 占位符，但该占位符的替换逻辑未在提供代码中体现，存在运行时路径解析失败的风险。
-   **任务元数据缺失**：每个任务除了需求描述字符串外，缺乏其他元数据，如任务类型、难度等级、所需环境、超时时间、输入输出规范等，不利于任务的自动化调度和管理。

### 优化建议

-   **引入配置文件**：将任务需求、数据路径、API端点等配置信息移出代码，存入独立的配置文件（如JSON、YAML或`.env`文件）。通过配置管理工具或模块加载这些配置，实现代码与配置的分离。
-   **消除重复，建立任务模板**：分析任务间的共性，创建可复用的任务模板或基类。例如，为“数据分析+建模”类任务定义一个模板，其中包含数据路径、目标变量、评估指标等可配置项。通过继承或组合来创建具体任务，避免重复。
-   **实施安全最佳实践**：立即移除代码中的明文密码。敏感信息（如API密钥、数据库密码）应通过环境变量或安全的密钥管理服务注入，绝不应出现在源代码或版本控制中。
-   **重构为模块化结构**：设计一个任务定义模块。可以创建一个 `Task` 基类或 `@dataclass`，包含 `id`、`name`、`description`、`category`、`config` 等属性。将现有字典重构为 `Task` 对象的集合或注册表。这为未来添加任务执行逻辑、验证、依赖管理等功能奠定了基础。
-   **明确路径解析逻辑**：定义一个统一的、明确的路径解析函数或配置项，用于处理 `{data_dir}` 这类占位符。确保所有文件路径都能被正确、一致地解析，避免运行时错误。
-   **丰富任务元数据模型**：扩展任务定义，纳入更多元数据字段，如 `task_type` (e.g., `ml`, `ocr`, `web_crawling`)、`difficulty`、`estimated_duration`、`required_packages`、`input_schema`、`output_schema`。这将极大地增强系统的可管理性、可观测性和自动化能力。


## 其它


### 设计目标与约束

本代码模块的核心设计目标是作为一个**任务需求描述库**，为上层应用（如智能体、自动化脚本）提供结构化的、可配置的自然语言任务指令。其主要约束包括：
1.  **指令标准化**：所有任务需求均以字符串常量形式定义，确保指令格式的统一性和可读性。
2.  **任务分类**：将任务明确划分为“ML-Benchmark”和“Open-Ended Tasks”两大类，便于管理和调用。
3.  **参数化**：部分指令字符串中包含 `{data_dir}` 等占位符，支持运行时根据实际数据路径进行动态替换，提高了指令的灵活性。
4.  **环境假设**：指令中明确声明了任务执行所需的环境（如“PaddleOCR环境已安装”、“pyxel环境已满足”），这构成了系统运行的外部约束和前置条件。

### 错误处理与异常设计

当前代码模块作为静态配置库，本身不包含运行时逻辑，因此没有显式的错误处理机制。其潜在的异常设计依赖于上层调用者：
1.  **配置缺失**：如果上层应用尝试通过 `ML_BENCHMARK_REQUIREMENTS` 或 `OPEN_ENDED_TASKS_REQUIREMENTS` 字典访问一个不存在的键（任务ID），将引发 `KeyError`。调用者应负责处理此类异常，例如提供默认值或给出明确错误提示。
2.  **字符串格式化错误**：在运行时替换指令字符串中的占位符（如 `{data_dir}`）时，如果提供的参数不匹配或缺失，会引发字符串格式化相关的异常（如 `KeyError` 或 `ValueError`）。参数替换逻辑应由上层调用者实现并确保其健壮性。
3.  **指令歧义**：由于指令为自然语言，可能存在理解歧义。当前设计未在代码层面处理此问题，依赖执行智能体或脚本的解析能力。这是系统层面的一个潜在风险点。

### 数据流与状态机

本模块不涉及动态数据流或复杂的状态转换。其数据流是静态和单向的：
1.  **数据定义**：所有任务需求在模块加载时被定义为字符串常量。
2.  **数据组织**：这些常量被分类并存入两个顶级字典 `ML_BENCHMARK_REQUIREMENTS` 和 `OPEN_ENDED_TASKS_REQUIREMENTS` 中，形成键值对映射（任务ID -> 任务指令）。
3.  **数据消费**：上层应用通过导入本模块，并访问上述字典来获取特定任务的指令字符串。获取的指令字符串将作为输入，传递给下游的执行单元（如LLM智能体、自动化脚本）。
该过程不涉及状态维护，是一个简单的“配置查询”模式。

### 外部依赖与接口契约

本模块的接口契约非常简单，主要体现为两个公开的字典常量：
1.  **导出接口**：
    *   `ML_BENCHMARK_REQUIREMENTS: Dict[str, str]`
    *   `OPEN_ENDED_TASKS_REQUIREMENTS: Dict[str, str]`
    任何导入此模块的代码都可以自由读取这两个字典。
2.  **外部依赖**：模块本身没有第三方库依赖。但是，其定义的**任务指令内容**隐含了对大量外部工具和环境的依赖，构成了与外部系统的“逻辑契约”，例如：
    *   **库/工具**：`sklearn`, `PaddleOCR`, `Selenium`, `rembg`, `stable diffusion`, `pyxel` 等。
    *   **数据**：特定路径下的CSV文件、图像文件。
    *   **服务**：可访问的网页URL、稳定的扩散模型服务端点（`sd_url`）。
    *   **账户**：邮件服务的账户和密码（示例中已脱敏）。
    这些依赖并非代码层面的 `import`，而是任务能够成功执行所必须满足的运行时环境条件。

### 安全与合规考虑

1.  **硬编码凭证**：`EMAIL_REPLY_REQ_08` 指令中包含了邮箱账户和密码的占位符。在实际部署中，**绝对禁止**将真实凭证硬编码在源码中。必须通过环境变量、密钥管理服务或安全的配置文件来注入此类敏感信息。
2.  **网络爬虫合规性**：`WEB_SEARCH_AND_CRAWLING_REQ_04` 至 `07` 以及 `WEB_PAGE_IMITATION_REQ_09` 至 `13` 涉及网页抓取和模仿。指令中未包含对 `robots.txt` 的尊重、请求频率限制、版权声明或个人信息处理等合规性要求。在实际应用中，执行这些任务的智能体或脚本必须内置相关合规逻辑。
3.  **数据使用**：ML基准任务使用了多个经典数据集（Iris, Titanic等），这些通常是公开的。但对于任何涉及用户数据或专有数据的任务，需要确保有合法的数据使用授权。
4.  **生成内容**：`TEXT2IMG_REQ_15` 和游戏生成任务涉及内容创建，需注意生成内容是否符合相关法律法规和平台政策。

### 配置管理与扩展性

1.  **配置方式**：当前采用Python源码作为配置文件。优点是简单直接，可利用Python语法；缺点是任何修改都需要更改代码并重新部署，不适合需要频繁动态更新配置的场景。
2.  **扩展机制**：要新增一个任务，开发人员需要：
    a. 在文件顶部添加一个新的任务需求字符串常量。
    b. 将其添加到对应的字典（`ML_BENCHMARK_REQUIREMENTS` 或 `OPEN_ENDED_TASKS_REQUIREMENTS`）中。
    这种扩展方式清晰但集中，当任务数量极大时，单个文件可能变得臃肿。未来可考虑将任务定义拆分为多个按领域划分的配置文件或使用JSON/YAML等外部配置格式。
3.  **版本管理**：任务指令的更改（如改进描述、更新路径）需要像管理代码一样进行版本控制。目前没有对任务指令本身进行版本标识的机制。


    