# `.\numpy\numpy\random\src\distributions\logfactorial.c`

```
/*
 *  logfact[k] holds log(k!) for k = 0, 1, 2, ..., 125.
 *  logfact数组存储了0到125的阶乘的自然对数值。
 */

static const double logfact[] = {
    0,                              // log(0!) = 0
    0,                              // log(1!) = 0
    0.69314718055994529,            // log(2!) ≈ 0.69314718055994529
    1.791759469228055,              // log(3!) ≈ 1.791759469228055
    3.1780538303479458,             // log(4!) ≈ 3.1780538303479458
    4.7874917427820458,             // log(5!) ≈ 4.7874917427820458
    6.5792512120101012,             // log(6!) ≈ 6.5792512120101012
    8.5251613610654147,             // log(7!) ≈ 8.5251613610654147
    10.604602902745251,             // log(8!) ≈ 10.604602902745251
    12.801827480081469,             // log(9!) ≈ 12.801827480081469
    15.104412573075516,             // log(10!) ≈ 15.104412573075516
    17.502307845873887,             // log(11!) ≈ 17.502307845873887
    19.987214495661885,             // log(12!) ≈ 19.987214495661885
    22.552163853123425,             // log(13!) ≈ 22.552163853123425
    25.19122118273868,              // log(14!) ≈ 25.19122118273868
    27.89927138384089,              // log(15!) ≈ 27.89927138384089
    30.671860106080672,             // log(16!) ≈ 30.671860106080672
    33.505073450136891,             // log(17!) ≈ 33.505073450136891
    36.395445208033053,             // log(18!) ≈ 36.395445208033053
    39.339884187199495,             // log(19!) ≈ 39.339884187199495
    42.335616460753485,             // log(20!) ≈ 42.335616460753485
    45.380138898476908,             // log(21!) ≈ 45.380138898476908
    48.471181351835227,             // log(22!) ≈ 48.471181351835227
    51.606675567764377,             // log(23!) ≈ 51.606675567764377
    54.784729398112319,             // log(24!) ≈ 54.784729398112319
    58.003605222980518,             // log(25!) ≈ 58.003605222980518
    61.261701761002001,             // log(26!) ≈ 61.261701761002001
    64.557538627006338,             // log(27!) ≈ 64.557538627006338
    67.88974313718154,              // log(28!) ≈ 67.88974313718154
    71.257038967168015,             // log(29!) ≈ 71.257038967168015
    74.658236348830158,             // log(30!) ≈ 74.658236348830158
    78.092223553315307,             // log(31!) ≈ 78.092223553315307
    81.557959456115043,             // log(32!) ≈ 81.557959456115043
    85.054467017581516,             // log(33!) ≈ 85.054467017581516
    88.580827542197682,             // log(34!) ≈ 88.580827542197682
    92.136175603687093,             // log(35!) ≈ 92.136175603687093
    95.719694542143202,             // log(36!) ≈ 95.719694542143202
    99.330612454787428,             // log(37!) ≈ 99.330612454787428
    102.96819861451381,             // log(38!) ≈ 102.96819861451381
    106.63176026064346,             // log(39!) ≈ 106.63176026064346
    110.32063971475739,             // log(40!) ≈ 110.32063971475739
    114.03421178146171,             // log(41!) ≈ 114.03421178146171
    117.77188139974507,             // log(42!) ≈ 117.77188139974507
    121.53308151543864,             // log(43!) ≈ 121.53308151543864
    125.3172711493569,              // log(44!) ≈ 125.3172711493569
    129.12393363912722,             // log(45!) ≈ 129.12393363912722
    132.95257503561632,             // log(46!) ≈ 132.95257503561632
    136.80272263732635,             // log(47!) ≈ 136.80272263732635
    140.67392364823425,             // log(48!) ≈ 140.67392364823425
    144.5657439463449,              // log(49!) ≈ 144.5657439463449
    148.47776695177302,             // log(50!) ≈ 148.47776695177302
    152.40959258449735,             // log(51!) ≈ 152.40959258449735
    156.3608363030788,              // log(52!) ≈ 156.3608363030788
    160.3311282166309,              // log(53!) ≈ 160.3311282166309
    164.32011226319517,             // log(54!) ≈ 164.32011226319517
    168.32744544842765,             // log(55!) ≈ 168.32744544842765
    172.35279713916279,             // log(56!) ≈ 172.35279713916279
    176.39584840699735,             // log(57!) ≈ 176.39584840699735
    180.45629141754378,             // log(58!) ≈ 180.45629141754378
    184.53382886144948,             // log(59!) ≈ 184.53382886144948
    188.6281734236716,              // log(60!) ≈ 188.6281734236716
    192.7390472878449,              // log(61!) ≈ 192.7390472878449
    196.86618167289001,             // log(62!) ≈ 196.86618167289001
    201.00931639928152,             // log(63!) ≈ 201.00931639928152
    205.1681994826412,              // log(64!) ≈ 205.1681994826412
    209.34258675253685,             // log(65!) ≈ 209.34258675253685
    213.53224149456327,             // log(66!) ≈ 213.53224149456327
    217.73693411395422,             // log(67!) ≈ 217.73693411395422
    221.95644181913033,             // log(68!) ≈ 221.95644181913033
    226.1905483237276,              // log(69!) ≈ 226.1905483237276
    230.43904356577696,             // log(70!) ≈ 230.43904356577696
    234.70172344281826,             // log(71!) ≈ 234.70172344281826
    238.97838956183432,             // log(72!) ≈ 238.97838956183432
    243.26884900298271,             // log(73!) ≈ 243.26884900298271
    247
    # 定义一个包含多个浮点数的列表，表示一组数值数据
    numbers = [
        462.60817852687489,
        467.4121995716082,
        472.22438392698058,
        477.04466549258564,
        481.87297922988796
    ]
};

/*
 *  计算 log(k!) 的函数
 */

double logfactorial(int64_t k)
{
    // 预先计算的常数，等于 ln(sqrt(2*pi))
    const double halfln2pi = 0.9189385332046728;

    // 如果 k 在预先计算的 logfact 数组的索引范围内，则直接使用查找表中的值
    if (k < (int64_t) (sizeof(logfact)/sizeof(logfact[0]))) {
        /* 使用查找表中的值 */
        return logfact[k];
    }

    /*
     *  使用斯特林级数展开，截断到 1/k**3 项。
     *  （在一个 Python 实现中，该近似方法对于 k 最大达到 10000000 时，结果在最佳 64 位浮点值的 ±2 个最低位误差之内。）
     */
    return (k + 0.5)*log(k) - k + (halfln2pi + (1.0/k)*(1/12.0 - 1/(360.0*k*k)));
}
```