# `.\numpy\doc\preprocess.py`

```py
#!/usr/bin/env python3
# 指定解释器
import subprocess
# 引入subprocess模块，用于生成子进程执行外部命令
import os
# 引入os模块，用于提供与操作系统交互的函数
import sys
# 引入sys模块，用于提供Python解释器与Python环境的相关功能
from string import Template
# 从string模块中引入Template类，用于字符串模板化

def main():
    # 调用doxy_gen函数，参数为程序的绝对路径
    doxy_gen(os.path.abspath(os.path.join('..')))

def doxy_gen(root_path):
    """
    Generate Doxygen configuration file.
    """
    # 调用doxy_config函数，参数为根路径
    confs = doxy_config(root_path)
    # 构建文档生成路径
    build_path = os.path.join(root_path, "doc", "build", "doxygen")
    # 生成文件路径
    gen_path = os.path.join(build_path, "Doxyfile")
    # 如果生成文件路径不存在，则创建
    if not os.path.exists(build_path):
        os.makedirs(build_path)
    # 以写入模式打开生成文件路径
    with open(gen_path, 'w') as fd:
        # 写入注释
        fd.write("#Please Don't Edit! This config file was autogenerated by ")
        # 写入注释
        fd.write(f"doxy_gen({root_path}) in doc/preprocess.py.\n")
        # 迭代写入配置信息
        for c in confs:
            fd.write(c)

class DoxyTpl(Template):
    delimiter = '@'

def doxy_config(root_path):
    """
    Fetch all Doxygen sub-config files and gather it with the main config file.
    """
    # 子配置列表
    confs = []
    # Doxygen源文件路径
    dsrc_path = os.path.join(root_path, "doc", "source")
    # 子配置信息
    sub = dict(ROOT_DIR=root_path)
    # 以读取模式打开Doxyfile文件
    with open(os.path.join(dsrc_path, "doxyfile")) as fd:
        # 实例化模板对象
        conf = DoxyTpl(fd.read())
        # 格式化子配置
        confs.append(conf.substitute(CUR_DIR=dsrc_path, **sub))

    # 遍历根路径下的所有文件和目录
    for dpath, _, files in os.walk(root_path):
        # 如果.doxyfile文件不在文件列表中，则继续循环
        if ".doxyfile" not in files:
            continue
        # 获取子配置文件路径
        conf_path = os.path.join(dpath, ".doxyfile")
        # 以读取模式打开子配置文件
        with open(conf_path) as fd:
            # 实例化模板对象
            conf = DoxyTpl(fd.read())
            # 格式化子配置
            confs.append(conf.substitute(CUR_DIR=dpath, **sub))
    # 返回所有配置信息
    return confs


if __name__ == "__main__":
    # 调用main函数
    main()
```